{
  "name": "extas/workflow",
  "package_classes": [
    {
      "interface": "workflowSchemaRepository",
      "class": "extas\\components\\workflows\\schemas\\SchemaRepository"
    },
    {
      "interface": "workflowSchemaSampleRepository",
      "class": "extas\\components\\workflows\\schemas\\SchemaSampleRepository"
    },
    {
      "interface": "workflowTransitionRepository",
      "class": "extas\\components\\workflows\\transitions\\TransitionRepository"
    },
    {
      "interface": "workflowTransitionSampleRepository",
      "class": "extas\\components\\workflows\\transitions\\TransitionSampleRepository"
    },
    {
      "interface": "workflowStateRepository",
      "class": "extas\\components\\workflows\\states\\StateRepository"
    },
    {
      "interface": "workflowStateSampleRepository",
      "class": "extas\\components\\workflows\\states\\StateSampleRepository"
    },
    {
      "interface": "workflowTransitionDispatcherRepository",
      "class": "extas\\components\\workflows\\transitions\\dispatchers\\TransitionDispatcherRepository"
    },
    {
      "interface": "workflowTransitionDispatcherSampleRepository",
      "class": "extas\\components\\workflows\\transitions\\dispatchers\\TransitionDispatcherSampleRepository"
    },
    {
      "interface": "workflowEntityRepository",
      "class": "extas\\components\\workflows\\entities\\EntityRepository"
    },
    {
      "interface": "workflowEntitySampleRepository",
      "class": "extas\\components\\workflows\\entities\\EntitySampleRepository"
    }
  ],
  "plugins": [
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallSchemas",
      "stage": "extas.install.section.workflow_schemas"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallSchemasSamples",
      "stage": "extas.install.section.workflow_schemas_samples"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallTransitions",
      "stage": "extas.install.section.workflow_transitions"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallTransitionsSamples",
      "stage": "extas.install.section.workflow_transitions_samples"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallStates",
      "stage": "extas.install.section.workflow_states"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallStatesSamples",
      "stage": "extas.install.section.workflow_states_samples"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallTransitionDispatchers",
      "stage": "extas.install.section.workflow_transition_dispatchers"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallTransitionDispatcherSamples",
      "stage": "extas.install.section.workflow_transition_dispatchers_samples"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallEntities",
      "stage": "extas.install.section.workflow_entities"
    },
    {
      "class": "extas\\components\\plugins\\workflows\\install\\InstallEntitiesSamples",
      "stage": "extas.install.section.workflow_entities_samples"
    },
    {
      "class": "extas\\components\\plugins\\repositories\\PluginFieldSampleName",
      "stage": [
        "extas.workflow_entities.create.before",
        "extas.workflow_schemas.create.before",
        "extas.workflow_states.create.before",
        "extas.workflow_transitions.create.before",
        "extas.workflow_transition_dispatchers.create.before"
      ]
    }
  ],
  "extensions": [
    {
      "class": "extas\\components\\extensions\\ExtensionRepositoryGet",
      "interface": "extas\\interfaces\\extensions\\IExtensionRepositoryGet",
      "subject": "*",
      "methods": [
        "workflowSchemaRepository",
        "workflowSchemaSampleRepository",
        "workflowStateRepository",
        "workflowStateSampleRepository",
        "workflowEntityRepository",
        "workflowEntitySampleRepository",
        "workflowTransitionRepository",
        "workflowTransitionSampleRepository",
        "workflowTransitionDispatcherRepository",
        "workflowTransitionDispatcherSampleRepository"
      ]
    }
  ],
  "fields": [
    {
      "name": "state_to",
      "value": "",
      "before_create": [
        {
          "condition": "!=",
          "value": "@parent.state_from"
        },
        {
          "condition": "in",
          "value": {
            "repository": "workflowStateRepository",
            "method": "all",
            "query": {
              "name": "@field_value"
            },
            "field": "name"
          }
        }
      ],
      "before_update": [
        {
          "condition": "!=",
          "value": "@parent.state_from"
        },
        {
          "condition": "in",
          "value": {
            "repository": "workflowStateRepository",
            "method": "all",
            "query": {
              "name": "@field_value"
            },
            "field": "name"
          }
        }
      ],
      "parameters": {
        "subject": {
          "name": "subject",
          "value": "extas.workflow.transition"
        }
      }
    },
    {
      "name": "state_from",
      "value": "",
      "before_create": [
        {
          "condition": "in",
          "value": {
            "repository": "workflowStateRepository",
            "method": "all",
            "query": {
              "name": "@field_value"
            },
            "field": "name"
          }
        }
      ],
      "before_update": [
        {
          "condition": "in",
          "value": {
            "repository": "workflowStateRepository",
            "method": "all",
            "query": {
              "name": "@field_value"
            },
            "field": "name"
          }
        }
      ],
      "parameters": {
        "subject": {
          "name": "subject",
          "value": "extas.workflow.transition"
        }
      }
    },
    {
      "name": "name",
      "before_delete": [
        {
          "condition": "not_in",
          "value": {
            "repository": "workflowTransitionRepository",
            "method": "all",
            "query": {
              "state_to": "@field_value"
            },
            "field": "state_to"
          }
        },
        {
          "condition": "not_in",
          "value": {
            "repository": "workflowTransitionRepository",
            "method": "all",
            "query": {
              "state_from": "@field_value"
            },
            "field": "state_from"
          }
        }
      ],
      "parameters": {
        "subject": {
          "name": "subject",
          "value": "extas.workflow.state"
        }
      }
    },
    {
      "name": "transition_name",
      "before_create": [
        {
          "condition": "in",
          "value": {
            "repository": "workflowTransitionRepository",
            "method": "all",
            "query": {
              "name": "@field_value"
            },
            "field": "name"
          }
        }
      ],
      "parameters": {
        "subject": {
          "name": "subject",
          "value": "extas.workflow.transition.dispatcher"
        }
      }
    }
  ]
}